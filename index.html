<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Kuis Pintar — 200 Level</title>
<link rel="icon" href="data:," />
<style>
  :root{
    --bg:#f4f7fb; --card:#fff; --text:#0f172a; --muted:#475569; --accent:#16a34a;
    --correct:#ecfdf5; --wrong:#fff1f0;
  }
  [data-theme="dark"]{
    --bg:#0b1220; --card:#071226; --text:#e6eef8; --muted:#9aa9c0; --accent:#059669;
    --correct:#052e1f; --wrong:#2b0b0b;
  }

  *{box-sizing:border-box}
  html,body{height:100%; margin:0; font-family:Inter, system-ui, Arial; background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased}
  .wrap{max-width:560px;margin:18px auto;padding:14px}
  .card{background:var(--card);border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(2,6,23,0.08)}
  header{display:flex;align-items:center;justify-content:space-between;gap:10px}
  h1{font-size:18px;margin:0}
  .small{font-size:13px;color:var(--muted)}
  .center{display:flex;flex-direction:column;align-items:center;gap:10px}

  .btn{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
  .muted{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px 10px;border-radius:10px;cursor:pointer;color:var(--muted)}
  .row{display:flex;gap:8px;align-items:center}
  .select{padding:8px;border-radius:8px;border:1px solid #e6eef9;background:transparent;color:var(--text)}

  #gameTop{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .level{font-weight:700}
  #questionBox{padding:14px;border-radius:12px;background:linear-gradient(180deg,#fff,#fbfdff);min-height:88px;display:flex;align-items:center}
  [data-theme="dark"] #questionBox{background:linear-gradient(180deg,#051729,#071226)}
  #question{font-size:18px;margin:0}

  .options{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
  .option{background:transparent;border-radius:10px;padding:12px;border:1px solid rgba(0,0,0,0.05);cursor:pointer;font-weight:600;display:flex;align-items:center;justify-content:center}
  .option:hover{transform:translateY(-3px);transition:all .18s}
  .option.correct{background:var(--correct);border-color:rgba(16,185,129,0.2)}
  .option.wrong{background:var(--wrong);border-color:rgba(239,68,68,0.18)}

  #lives{display:flex;gap:6px;align-items:center}
  .heart{width:16px;height:16px;border-radius:4px;background:#ef4444;display:inline-block}
  .heart.gray{opacity:.35;background:#ef9a9a}

  .progress{height:10px;background:rgba(0,0,0,0.06);border-radius:999px;overflow:hidden}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#4f46e5);width:0%}

  footer{display:flex;align-items:center;gap:8px;margin-top:14px}
  .muted-small{font-size:13px;color:var(--muted)}

  /* animations */
  .slide-in{animation: slideIn .28s ease}
  @keyframes slideIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

  @media (max-width:520px){
    .options{grid-template-columns:1fr}
    .wrap{padding:10px}
  }

  /* small helpers */
  pre{white-space:pre-wrap;word-wrap:break-word}
</style>
</head>
<body>
<div class="wrap">
  <!-- START CARD -->
  <div class="card" id="startCard">
    <header>
      <div>
        <h1>Kuis Pintar — 200 Level</h1>
        <div class="small">Mode: 1 soal / level • Soal acak dari semua topik</div>
      </div>
      <div class="small">by Azria</div>
    </header>

    <div class="center" style="margin-top:12px">
      <p class="small" style="text-align:center;max-width:420px">
        Kamu akan mulai dari Level 1. Satu jawaban benar = naik level. Salah = -1 nyawa. Kehabisan nyawa → Game Over. Progress tersimpan otomatis.
      </p>

      <div style="display:flex;gap:8px; width:100%">
        <button class="btn" id="startBtn">Mulai Game</button>
        <button class="muted" id="themeToggle">Mode: Auto</button>
      </div>

      <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
        <div class="small">Tema auto: aktif (siang → terang, malam → gelap)</div>
      </div>
    </div>
  </div>

  <!-- GAME CARD -->
  <div class="card" id="gameCard" style="display:none;margin-top:12px">
    <div id="gameTop">
      <div>
        <div class="level">Level <span id="levelNum">1</span> / 200</div>
        <div class="small" id="categoryLabel">Kategori: —</div>
      </div>

      <div style="display:flex;align-items:center;gap:12px">
        <div id="lives" class="small"></div>
        <div style="width:140px">
          <div class="progress" aria-hidden><i id="progressBar"></i></div>
        </div>
      </div>
    </div>

    <div id="questionBox" class="slide-in card" style="margin-top:10px;padding:12px">
      <div id="question">Memuat soal...</div>
    </div>

    <div class="options" id="optionsBox" style="margin-top:10px"></div>

    <footer>
      <div class="muted-small">Skor: <strong id="score">0</strong></div>
      <div style="flex:1"></div>
      <button class="muted" id="skipBtn">Lewati</button>
    </footer>
  </div>

  <!-- END CARD -->
  <div class="card" id="endCard" style="display:none;margin-top:12px;text-align:center">
    <h2 id="endTitle">Selesai</h2>
    <pre id="endMsg" class="small" style="white-space:pre-wrap"></pre>
    <div style="display:flex;justify-content:center;gap:8px;margin-top:12px">
      <button class="btn" id="playAgain">Main Lagi</button>
      <button class="muted" id="continueBtn">Lanjutkan Tersimpan</button>
    </div>
    <div class="small" style="margin-top:8px">Highscore & progress tersimpan di perangkat.</div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const MAX_LEVELS = 200;
let currentLevel = 1;
let score = 0;
let lives = 3;
let questionPool = [];
let usedIndexes = new Set();
let currentQuestion = null;

/* ================ THEME (AUTO) ================ */
const root = document.documentElement;
function detectThemeAuto(){
  // prefer system if available, else time-based
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
  // use local time heuristic: night between 18-6
  const hour = new Date().getHours();
  const night = (hour >= 18 || hour < 6);
  // choose dark if system prefers dark OR it's night
  return (prefersDark || night) ? 'dark' : 'light';
}
function applyThemeMode(mode){
  if(mode === 'auto'){
    const t = detectThemeAuto();
    document.documentElement.setAttribute('data-theme', t === 'dark' ? 'dark' : 'light');
    document.getElementById('themeToggle').innerText = 'Mode: Auto';
  } else if(mode === 'dark'){
    document.documentElement.setAttribute('data-theme', 'dark');
    document.getElementById('themeToggle').innerText = 'Mode: Gelap';
  } else {
    document.documentElement.setAttribute('data-theme', 'light');
    document.getElementById('themeToggle').innerText = 'Mode: Terang';
  }
}
let themeMode = localStorage.getItem('kuis_theme') || 'auto';
applyThemeMode(themeMode);
document.getElementById('themeToggle').addEventListener('click', ()=>{
  // cycle auto -> light -> dark -> auto
  themeMode = themeMode === 'auto' ? 'light' : themeMode === 'light' ? 'dark' : 'auto';
  localStorage.setItem('kuis_theme', themeMode);
  applyThemeMode(themeMode);
});

/* ============== AUDIO FEEDBACK ============== */
let audioCtx;
try{ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }catch(e){ audioCtx = null; }
function tone(freq,d=0.06){
  if(!audioCtx) return;
  const o = audioCtx.createOscillator(), g = audioCtx.createGain();
  o.type='sine'; o.frequency.value=freq; g.gain.value=0.06;
  o.connect(g); g.connect(audioCtx.destination); o.start();
  setTimeout(()=> o.stop(), d*1000);
}
function playCorrect(){ tone(880,0.06); setTimeout(()=>tone(1320,0.06),80); }
function playWrong(){ tone(220,0.14); }

/* ============== QUESTION POOL GENERATOR ============== */
/* We'll combine curated + generated questions across topics to reach enough items */
const curated = [
  {q:'Ibukota Indonesia?', options:['Bandung','Jakarta','Surabaya','Medan'], a:1, cat:'Geografi'},
  {q:'Planet terdekat dari Matahari?', options:['Mars','Bumi','Merkurius','Venus'], a:2, cat:'Astronomi'},
  {q:'5 + 7 = ?', options:['10','12','13','11'], a:1, cat:'Matematika'},
  {q:'Hewan tercepat di darat?', options:['Singa','Kelinci','Cheetah','Kuda'], a:2, cat:'Biologi'},
  {q:'Bahasa resmi Brasil?', options:['Spanyol','Portugis','Inggris','Prancis'], a:1, cat:'Bahasa'},
  {q:'Siapa penulis "Harry Potter"?', options:['Suzanne Collins','J.K. Rowling','Stephen King','Agatha Christie'], a:1, cat:'Sastra'},
  {q:'Titik didih air (°C)?', options:['90','80','100','120'], a:2, cat:'Sains'},
  {q:'Simbol kimia untuk emas?', options:['Ag','Au','Fe','Pb'], a:1, cat:'Sains'},
  {q:'Gunung tertinggi di dunia?', options:['K2','Kilimanjaro','Everest','Elbrus'], a:2, cat:'Geografi'},
  {q:'Siapa presiden pertama Indonesia?', options:['Sukarno','Soeharto','Habibie','Megawati'], a:0, cat:'Sejarah'},
];

function shuffle(arr){ return arr.sort(()=>0.5-Math.random()); }

function generatePool(){
  questionPool = [...curated];

  // arithmetic generated
  for(let i=0;i<140;i++){
    let a = Math.floor(Math.random()*25)+1;
    let b = Math.floor(Math.random()*25)+1;
    const ops = ['+','-','x'];
    let op = ops[Math.floor(Math.random()*ops.length)];
    let qtxt, correct;
    if(op==='+'){ qtxt = `${a} + ${b} = ?`; correct = a+b; }
    else if(op==='-'){ qtxt = `${a+b} - ${b} = ?`; correct = a; }
    else { qtxt = `${a} x ${b} = ?`; correct = a*b; }

    let opts = [correct, correct + (Math.floor(Math.random()*3)+1), Math.max(1, correct - (Math.floor(Math.random()*3)+1)), correct + (Math.floor(Math.random()*5)+4)];
    opts = shuffle(opts).map(x=>String(x));
    const idx = opts.indexOf(String(correct));
    questionPool.push({q:qtxt, options:opts, a:idx, cat:'Matematika'});
  }

  // country capitals
  const caps = [
    ['Argentina','Buenos Aires'],['Australia','Canberra'],['Austria','Vienna'],
    ['Belgium','Brussels'],['Canada','Ottawa'],['China','Beijing'],
    ['Denmark','Copenhagen'],['Egypt','Cairo'],['Finland','Helsinki'],
    ['France','Paris'],['Germany','Berlin'],['Greece','Athens'],
    ['India','New Delhi'],['Italy','Rome'],['Japan','Tokyo'],
    ['Kenya','Nairobi'],['Malaysia','Kuala Lumpur'],['Mexico','Mexico City'],
    ['Netherlands','Amsterdam'],['Norway','Oslo'],['Spain','Madrid'],['Sweden','Stockholm']
  ];
  for(const [country,capital] of caps){
    const wrongs = shuffle(caps.filter(c=>c[0]!==country)).slice(0,3).map(x=>x[1]);
    const opts = shuffle([capital,...wrongs]);
    questionPool.push({q:`Ibukota ${country}?`, options:opts, a:opts.indexOf(capital), cat:'Geografi'});
  }

  // science & misc
  const facts = [
    {q:'Air membeku pada suhu berapa (°C)?', options:['0','100','-10','32'], a:0, cat:'Sains'},
    {q:'Simbol untuk oksigen?', options:['O','Ox','Og','O2'], a:0, cat:'Sains'},
    {q:'Organ yang memompa darah?', options:['Paru-paru','Jantung','Hati','Ginjal'], a:1, cat:'Biologi'},
    {q:'Satuan frekuensi?', options:['Pascal','Hertz','Newton','Watt'], a:1, cat:'Sains'},
    {q:'Alat musik petik?', options:['Drum','Gitar','Saxophone','Terompet'], a:1, cat:'Seni'}
  ];
  questionPool.push(...facts);

  // fill until enough
  const animals = ['Kucing','Anjing','Gajah','Singa','Kuda','Kelinci','Kambing','Domba','Beruang','Serigala','Cheetah','Zebra'];
  while(questionPool.length < Math.ceil(MAX_LEVELS * 1.3)){
    if(Math.random() < 0.5){
      const correct = animals[Math.floor(Math.random()*animals.length)];
      const wrongs = [];
      while(wrongs.length < 3){
        const pick = animals[Math.floor(Math.random()*animals.length)];
        if(pick !== correct && !wrongs.includes(pick)) wrongs.push(pick);
      }
      const opts = shuffle([correct,...wrongs]);
      questionPool.push({q:`Manakah hewan: ${correct}?`, options:opts, a:opts.indexOf(correct), cat:'Biologi'});
    } else {
      const n = Math.floor(Math.random()*90)+10;
      const add = Math.floor(Math.random()*9)+1;
      const correct = n + add;
      const opts = shuffle([correct, correct+2, Math.max(1, correct-3), correct+5]).map(x=>String(x));
      questionPool.push({q:`Berapakah ${n} + ${add}?`, options:opts, a:opts.indexOf(String(correct))>=0?opts.indexOf(String(correct)):0, cat:'Campuran'});
    }
  }

  // final shuffle pool
  questionPool = shuffle(questionPool);
}

/* ============== STORAGE ============== */
function saveProgress(){
  localStorage.setItem('kuis_pintar_save', JSON.stringify({level: currentLevel, score, lives}));
  const high = Math.max(parseInt(localStorage.getItem('kuis_pintar_highscore')||0), score);
  localStorage.setItem('kuis_pintar_highscore', String(high));
}
function loadSaved(){
  const s = JSON.parse(localStorage.getItem('kuis_pintar_save')||'null');
  if(s && s.level && s.level <= MAX_LEVELS) return s;
  return null;
}

/* ============== UI HELPERS ============== */
const startBtn = document.getElementById('startBtn');
const startCard = document.getElementById('startCard');
const gameCard = document.getElementById('gameCard');
const endCard = document.getElementById('endCard');
const questionEl = document.getElementById('question');
const optionsBox = document.getElementById('optionsBox');
const levelNum = document.getElementById('levelNum');
const categoryLabel = document.getElementById('categoryLabel');
const livesEl = document.getElementById('lives');
const scoreEl = document.getElementById('score');
const progressBar = document.getElementById('progressBar');
const skipBtn = document.getElementById('skipBtn');
const playAgain = document.getElementById('playAgain');
const continueBtn = document.getElementById('continueBtn');

function renderLives(){
  livesEl.innerHTML = '';
  for(let i=0;i<3;i++){
    const s = document.createElement('span');
    s.className = 'heart' + (i >= lives ? ' gray' : '');
    livesEl.appendChild(s);
  }
}

function updateProgress(){
  const pct = Math.round((currentLevel - 1) / MAX_LEVELS * 100);
  progressBar.style.width = pct + '%';
}

/* ============== CORE FLOW ============== */
function pickQuestion(){
  if(usedIndexes.size >= questionPool.length) usedIndexes.clear();
  let idx;
  do { idx = Math.floor(Math.random() * questionPool.length); } while(usedIndexes.has(idx));
  usedIndexes.add(idx);
  // deep copy
  return JSON.parse(JSON.stringify(questionPool[idx]));
}

function renderQuestion(q){
  questionEl.innerText = q.q;
  optionsBox.innerHTML = '';
  q.options.forEach((opt, i)=>{
    const d = document.createElement('div');
    d.className = 'option';
    d.innerText = opt;
    d.addEventListener('click', ()=> selectAnswer(i, d));
    optionsBox.appendChild(d);
  });
  categoryLabel.innerText = 'Kategori: ' + (q.cat || 'Campuran');
}

function loadNext(){
  if(currentLevel > MAX_LEVELS){
    finish(true); return;
  }
  currentQuestion = pickQuestion();
  renderQuestion(currentQuestion);
  levelNum.innerText = currentLevel;
  updateProgress();
  renderLives();
  saveProgress();
}

function selectAnswer(i, el){
  // disable clicks
  Array.from(optionsBox.children).forEach(x => x.style.pointerEvents = 'none');
  const correct = currentQuestion.a;
  if(i === correct){
    el.classList.add('correct');
    try{ playCorrect(); }catch(e){}
    score++;
    scoreEl.innerText = score;
  } else {
    el.classList.add('wrong');
    try{ playWrong(); }catch(e){}
    lives--;
    renderLives();
    // reveal correct
    const opts = Array.from(optionsBox.children);
    if(opts[correct]) opts[correct].classList.add('correct');
  }
  // next after short delay
  setTimeout(()=>{
    if(lives <= 0){ finish(false); return; }
    currentLevel++;
    if(currentLevel > MAX_LEVELS){ finish(true); return; }
    loadNext();
  }, 650);
}

function finish(perfect){
  gameCard.style.display = 'none';
  endCard.style.display = 'block';
  document.getElementById('endTitle').innerText = lives > 0 ? 'Kamu Menyelesaikan Kuis!' : 'Game Over';
  const high = parseInt(localStorage.getItem('kuis_pintar_highscore')||0);
  document.getElementById('endMsg').innerText = `Level tercapai: ${Math.min(currentLevel, MAX_LEVELS)}\nSkor: ${score}\nHighscore: ${Math.max(high, score)}`;
  localStorage.setItem('kuis_pintar_highscore', String(Math.max(high, score)));
  saveProgress();
}

/* ============== BUTTONS ============== */
startBtn.addEventListener('click', ()=>{
  const saved = loadSaved();
  if(saved){
    if(confirm('Terdapat progress tersimpan. Lanjut dari level ' + saved.level + '? OK = lanjut, Cancel = mulai baru')){
      currentLevel = saved.level; score = saved.score; lives = saved.lives;
    } else {
      currentLevel = 1; score = 0; lives = 3; usedIndexes.clear();
    }
  } else {
    currentLevel = 1; score = 0; lives = 3; usedIndexes.clear();
  }
  startCard.style.display = 'none';
  gameCard.style.display = 'block';
  endCard.style.display = 'none';
  renderLives(); scoreEl.innerText = score;
  updateProgress();
  loadNext();
});

skipBtn.addEventListener('click', ()=>{
  // allow skip without penalty, move to next level (mark used)
  if(currentQuestion){
    // nothing extra needed because pickQuestion marks usedIndexes when selected next time
  }
  currentLevel++;
  if(currentLevel > MAX_LEVELS){ finish(true); return; }
  loadNext();
});

playAgain.addEventListener('click', ()=>{
  localStorage.removeItem('kuis_pintar_save');
  currentLevel = 1; score = 0; lives = 3; usedIndexes.clear();
  startCard.style.display = 'none'; gameCard.style.display = 'block'; endCard.style.display = 'none';
  renderLives(); scoreEl.innerText = score; loadNext();
});

continueBtn.addEventListener('click', ()=>{
  const s = loadSaved();
  if(s){
    currentLevel = s.level; score = s.score; lives = s.lives;
    startCard.style.display='none'; gameCard.style.display='block'; endCard.style.display='none';
    renderLives(); scoreEl.innerText = score; loadNext();
  } else {
    alert('Tidak ada progress tersimpan.');
  }
});

/* ============== INIT ============== */
generatePool();
applyThemeMode(themeMode);
renderLives();
scoreEl.innerText = score;
updateProgress();
// show continue button if saved
if(loadSaved()) continueBtn.style.display = 'inline-block';
else continueBtn.style.display = 'none';

// expose pool for debugging if needed (dev only)
window._KUIS = { questionPool };
</script>
</body>
</html>